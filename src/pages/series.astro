---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import { slugifyStr } from "@utils/slugify";

const posts = await getCollection("blog");

const seriesMap = new Map();

posts.forEach(post => {
  if (post.data.series) {
    const { name, order } = post.data.series;
    if (!seriesMap.has(name)) {
      seriesMap.set(name, []);
    }
    seriesMap.get(name).push({ ...post, order });
  }
});

const sortedSeries = Array.from(seriesMap.entries()).map(([name, posts]) => ({
  name,
  posts: posts.sort((a, b) => a.order - b.order),
}));
---

<Layout title="All Series">
  <Header />
  <main id="main-content">
    <section id="series">
      <h1 class="mb-6 text-2xl font-semibold">All Series</h1>
      {
        sortedSeries.map(series => (
          <div class="mb-8">
            <h2 class="mb-2 text-xl font-semibold">{series.name}</h2>
            <ul class="list-inside list-decimal">
              {series.posts.map(post => (
                <li class="my-1">
                  <a
                    href={`/posts/${slugifyStr(post.slug)}/`}
                    class="text-skin-accent hover:underline"
                  >
                    {post.data.title}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))
      }
    </section>
  </main>
  <Footer />
</Layout>

<style>
  #series {
    @apply mx-auto w-full max-w-3xl px-4 pb-12;
  }
</style>
